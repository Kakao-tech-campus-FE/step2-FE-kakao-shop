import Container from "../atoms/Container";
import ProductGrid from "../organisms/ProductGrid";
import {useState, useRef, useEffect} from "react";
import { useQuery } from "react-query";
import { fetchProducts } from "../../services/product";
import { Container } from "react-dom";

const MainProductTemplate = () => {
    const [page, setPage] = useState(0);
    const bottomObserver = useRef(null);

    function usePage(page) { 
        return useQuery({
        queryKey: ['products', page],
        queryFn: () => {fetchProducts(page)},
        enabled: !!page,
    })};

    const { isLoading, error, data } = usePage(page)
    
    const io = new IntersectionObserver((entires, observer) => {
        entires.forEach((entry) => {
            if (entry.isIntersecting) {
                setPage((page) => page + 1);
            }
        });
    });

    useEffect(() => {
        if (isLoading) {
            io.observe(bottomObserver.current);
        }
    }, [isLoading]);

    return (
        <Container>
        
    );
};

export default MainProductTemplate;